<!DOCTYPE html>
<html lang="km">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìà Universal Function Plotter</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.11.0/math.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
        background-image: url('photo_2024-09-27_17-31-08.jpg');
        background-size: cover;
        background-position: center;
        background-attachment: fixed;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6); /* overlay ·ûÑ·ûÑ·ûπ·ûè */
            backdrop-filter: blur(3px); /* ·ûí·üí·ûú·ûæ·û±·üí·ûô·ûü·üí·ûö·û¢·û∂·ûî·üã·ûî·ûì·üí·ûè·û∑·ûÖ */
            z-index: -1;
        }


        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            color: #fff;
            margin-bottom: 30px;
            font-size: 28px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .input-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
            color: #a0a0a0;
        }

        input[type="text"] {
            width: 100%;
            padding: 12px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: #fff;
            font-size: 15px;
            transition: all 0.3s;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #4a90e2;
            background: rgba(255, 255, 255, 0.15);
        }

        input::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        .range-group {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .range-group input {
            flex: 1;
        }

        .style-group {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        select {
            flex: 1;
            padding: 12px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: #fff;
            font-size: 14px;
            cursor: pointer;
        }

        select option {
            background: #1a1a2e;
            color: #fff;
        }

        .button-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            margin-bottom: 20px;
        }

        .btn {
            padding: 12px;
            background: rgba(74, 144, 226, 0.2);
            border: 1px solid rgba(74, 144, 226, 0.4);
            border-radius: 8px;
            color: #fff;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .btn:hover {
            background: rgba(74, 144, 226, 0.4);
            transform: translateY(-2px);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-clear {
            background: rgba(226, 74, 74, 0.2);
            border-color: rgba(226, 74, 74, 0.4);
        }

        .btn-clear:hover {
            background: rgba(226, 74, 74, 0.4);
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .btn-primary {
            flex: 2;
            padding: 16px;
            background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%);
            border: none;
            border-radius: 8px;
            color: #fff;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(74, 144, 226, 0.4);
        }

        .btn-secondary {
            flex: 1;
            padding: 12px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .chart-container {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        #myChart {
            max-height: 500px;
        }

        .status {
            text-align: center;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .status.success {
            background: rgba(76, 175, 80, 0.2);
            border: 1px solid rgba(76, 175, 80, 0.4);
            color: #4caf50;
        }

        .status.error {
            background: rgba(244, 67, 54, 0.2);
            border: 1px solid rgba(244, 67, 54, 0.4);
            color: #f44336;
        }

        .footer {
            text-align: center;
            color: #666;
            font-size: 12px;
            margin-top: 20px;
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìà Universal Function Plotter</h1>

        <div class="input-group">
            <label>Functions (·ûü·ûº·ûò·ûî·üÜ·ûî·üÇ·ûÄ·ûä·üÑ·ûô ; )</label>
            <input type="text" id="functions" placeholder="sin(x); exp(x); x^2">
        </div>

        <div class="input-group">
            <label>Colors (·ûá·û∂·ûá·ûò·üí·ûö·ûæ·ûü)</label>
            <input type="text" id="colors" placeholder="red; blue; green">
        </div>

        <div class="input-group">
            <label>Vertical Asymptotes (x=)</label>
            <input type="text" id="vertAsymptotes" placeholder="x=1; 2.5">
        </div>

        <div class="input-group">
            <label>Vertical Asymptote Colors (·ûá·û∂·ûá·ûò·üí·ûö·ûæ·ûü)</label>
            <input type="text" id="vertColors" placeholder="red; gray">
        </div>

        <div class="input-group">
            <label>Horizontal Asymptotes (y=)</label>
            <input type="text" id="horizAsymptotes" placeholder="y=3; -1">
        </div>

        <div class="input-group">
            <label>Horizontal Asymptote Colors (·ûá·û∂·ûá·ûò·üí·ûö·ûæ·ûü)</label>
            <input type="text" id="horizColors" placeholder="blue; gray">
        </div>

        <div class="range-group">
            <div class="input-group" style="margin-bottom: 0;">
                <label>X Min</label>
                <input type="text" id="xMin" value="-10">
            </div>
            <div class="input-group" style="margin-bottom: 0;">
                <label>X Max</label>
                <input type="text" id="xMax" value="10">
            </div>
        </div>

        <div class="style-group">
            <div style="flex: 1;">
                <label>Line Style</label>
                <select id="lineStyle">
                    <option value="solid">Solid (‚Äî)</option>
                    <option value="dashed">Dashed (- -)</option>
                    <option value="dotted">Dotted (¬∑¬∑¬∑)</option>
                </select>
            </div>
            <div style="flex: 1;">
                <label>Line Width</label>
                <select id="lineWidth">
                    <option value="1">1</option>
                    <option value="2" selected>2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                </select>
            </div>
        </div>

        <div class="button-grid">
            <button class="btn" onclick="insertText('x')">x</button>
            <button class="btn" onclick="insertText('x^2')">x¬≤</button>
            <button class="btn" onclick="insertText('x^')">x‚Åø</button>
            <button class="btn" onclick="insertText('sqrt(')">‚àö</button>
            <button class="btn" onclick="insertText('1/x')">1/x</button>
            <button class="btn" onclick="insertText('exp(')">exp</button>
            <button class="btn" onclick="insertText('log(')">ln</button>
            <button class="btn" onclick="insertText('sin(')">sin</button>
            <button class="btn" onclick="insertText('cos(')">cos</button>
            <button class="btn" onclick="insertText('tan(')">tan</button>
            <button class="btn" onclick="insertText('abs(')">|x|</button>
            <button class="btn" onclick="insertText('pi')">œÄ</button>
            <button class="btn" onclick="insertText('(')">(</button>
            <button class="btn" onclick="insertText(')')">)</button>
            <button class="btn" onclick="insertText('+')">+</button>
            <button class="btn" onclick="insertText('-')">-</button>
            <button class="btn" onclick="insertText('*')">√ó</button>
            <button class="btn" onclick="insertText('/')">√∑</button>
            <button class="btn btn-clear" onclick="clearInput()">Clear</button>
        </div>

        <div class="action-buttons">
            <button class="btn-primary" onclick="plotGraph()">üìä Plot Graph</button>
            <button class="btn-secondary" onclick="saveGraph()">üíæ Save</button>
            <button class="btn-secondary" onclick="copyGraph()">üìã Copy</button>
        </div>

        <div id="status" class="status hidden"></div>

        <div class="chart-container" id="chartContainer" style="display: none;">
            <canvas id="myChart"></canvas>
        </div>

        <div class="footer">Copyright ¬© Ol Chanthoeun</div>
    </div>

    <script>
        let currentChart = null;
        const functionsInput = document.getElementById('functions');
        const autoColors = ['blue', 'red', 'green', 'purple', 'orange', 'black', 'brown', 'pink'];

        function insertText(text) {
            const input = functionsInput;
            const pos = input.selectionStart;
            const val = input.value;
            input.value = val.substring(0, pos) + text + val.substring(pos);
            input.focus();
            input.selectionStart = input.selectionEnd = pos + text.length;
        }

        function clearInput() {
            functionsInput.value = '';
            functionsInput.focus();
        }

        function showStatus(message, type) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${type}`;
            status.classList.remove('hidden');
        }

        function normalizeExpression(expr) {
            expr = expr.trim().toLowerCase();
            expr = expr.replace(/ln/g, 'log');
            expr = expr.replace(/\s/g, '');
            if (expr.includes('=')) {
                expr = expr.split('=')[1];
            }
            return expr;
        }

        function plotGraph() {
            try {
                const functionsRaw = document.getElementById('functions').value;
                const colorsRaw = document.getElementById('colors').value;
                const xMin = parseFloat(document.getElementById('xMin').value);
                const xMax = parseFloat(document.getElementById('xMax').value);
                const lineStyle = document.getElementById('lineStyle').value;
                const lineWidth = parseInt(document.getElementById('lineWidth').value);

                const functions = functionsRaw.split(';').map(f => f.trim()).filter(f => f);
                const colors = colorsRaw.split(';').map(c => c.trim()).filter(c => c);

                if (functions.length === 0) {
                    showStatus('‚ùå Please enter at least one function', 'error');
                    return;
                }

                const points = 2000;
                const step = (xMax - xMin) / points;
                const xValues = [];
                for (let i = 0; i <= points; i++) {
                    xValues.push(xMin + i * step);
                }

                const datasets = [];

                functions.forEach((func, idx) => {
                    const normalized = normalizeExpression(func);
                    const yValues = xValues.map(x => {
                        try {
                            const result = math.evaluate(normalized, { x: x });
                            if (!isFinite(result) || Math.abs(result) > 1000) {
                                return null;
                            }
                            return result;
                        } catch (e) {
                            return null;
                        }
                    });

                    const color = idx < colors.length ? colors[idx] : autoColors[idx % autoColors.length];

                    datasets.push({
                        label: `f(x) = ${func}`,
                        data: yValues,
                        borderColor: color,
                        backgroundColor: color,
                        borderWidth: lineWidth,
                        borderDash: lineStyle === 'dashed' ? [10, 5] : lineStyle === 'dotted' ? [2, 2] : [],
                        tension: 0.1,
                        pointRadius: 0,
                        spanGaps: false
                    });
                });

                // Add vertical asymptotes
                const vertAsymptotes = document.getElementById('vertAsymptotes').value;
                const vertColors = document.getElementById('vertColors').value;
                if (vertAsymptotes) {
                    const verts = vertAsymptotes.split(';').map(v => v.trim()).filter(v => v);
                    const vColors = vertColors.split(';').map(c => c.trim()).filter(c => c);
                    
                    verts.forEach((vert, idx) => {
                        let val = vert.toLowerCase().startsWith('x=') ? vert.substring(2) : vert;
                        const xVal = parseFloat(val);
                        if (!isNaN(xVal)) {
                            const color = idx < vColors.length ? vColors[idx] : 'gray';
                            datasets.push({
                                label: `x = ${xVal}`,
                                data: [{x: xVal, y: -1000}, {x: xVal, y: 1000}],
                                borderColor: color,
                                borderWidth: 1,
                                borderDash: [5, 5],
                                pointRadius: 0,
                                showLine: true
                            });
                        }
                    });
                }

                // Add horizontal asymptotes
                const horizAsymptotes = document.getElementById('horizAsymptotes').value;
                const horizColors = document.getElementById('horizColors').value;
                if (horizAsymptotes) {
                    const horizs = horizAsymptotes.split(';').map(h => h.trim()).filter(h => h);
                    const hColors = horizColors.split(';').map(c => c.trim()).filter(c => c);
                    
                    horizs.forEach((horiz, idx) => {
                        let val = horiz.toLowerCase().startsWith('y=') ? horiz.substring(2) : horiz;
                        const yVal = parseFloat(val);
                        if (!isNaN(yVal)) {
                            const color = idx < hColors.length ? hColors[idx] : 'gray';
                            datasets.push({
                                label: `y = ${yVal}`,
                                data: [{x: xMin, y: yVal}, {x: xMax, y: yVal}],
                                borderColor: color,
                                borderWidth: 1,
                                borderDash: [5, 5],
                                pointRadius: 0,
                                showLine: true
                            });
                        }
                    });
                }

                if (currentChart) {
                    currentChart.destroy();
                }

                const ctx = document.getElementById('myChart').getContext('2d');
                currentChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: xValues,
                        datasets: datasets
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Universal Function Plotter',
                                font: { size: 16 }
                            },
                            legend: {
                                display: true,
                                position: 'top'
                            }
                        },
                        scales: {
                            x: {
                                type: 'linear',
                                position: 'bottom',
                                title: {
                                    display: true,
                                    text: 'x'
                                },
                                grid: {
                                    color: 'rgba(0, 0, 0, 0.1)'
                                }
                            },
                            y: {
                                title: {
                                    display: true,
                                    text: 'y'
                                },
                                grid: {
                                    color: 'rgba(0, 0, 0, 0.1)'
                                }
                            }
                        }
                    }
                });

                document.getElementById('chartContainer').style.display = 'block';
                showStatus('‚úÖ Graph plotted successfully', 'success');

            } catch (error) {
                showStatus(`‚ùå Error: ${error.message}`, 'error');
            }
        }

        function saveGraph() {
            if (!currentChart) {
                showStatus('‚ùå No graph to save', 'error');
                return;
            }
            const url = currentChart.toBase64Image();
            const link = document.createElement('a');
            link.download = 'function-plot.png';
            link.href = url;
            link.click();
            showStatus('üíæ Graph saved', 'success');
        }

        function copyGraph() {
            if (!currentChart) {
                showStatus('‚ùå No graph to copy', 'error');
                return;
            }
            currentChart.canvas.toBlob(blob => {
                navigator.clipboard.write([
                    new ClipboardItem({ 'image/png': blob })
                ]).then(() => {
                    showStatus('üìã Graph copied to clipboard', 'success');
                }).catch(() => {
                    showStatus('‚ùå Failed to copy graph', 'error');
                });
            });
        }
    </script>
</body>
</html>